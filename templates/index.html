{% extends "base.html" %}
{% block title %}{{ _("Employees") }}{% endblock %}
{% block content %}
<!-- vscode-disable-javascript-validation -->
<style>
  /* === HEADER === */
  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 3rem 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
    position: relative;
    overflow: hidden;
  }

  .page-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
  }

  .page-header h2 {
    color: white;
    font-weight: 700;
    font-size: 2.5rem;
    margin: 0;
    position: relative;
    z-index: 1;
  }

  .page-header .subtitle {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.1rem;
    margin-top: 0.5rem;
    font-weight: 300;
  }

  .btn-add-employee {
    background: white;
    color: #667eea;
    padding: 0.8rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    border: none;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    position: relative;
    z-index: 1;
  }

  .btn-add-employee:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    color: #667eea;
  }

  /* === TABLE === */
  .employee-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: none;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .employee-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.2);
  }

  .table-modern {
    margin: 0;
  }

  .table-modern thead {
    background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
  }

  .table-modern thead th {
    border: none;
    padding: 1.2rem 1rem;
    font-weight: 600;
    color: #667eea;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
  }

  .table-modern tbody tr {
    border-bottom: 1px solid #f1f3f5;
    transition: all 0.2s ease;
  }

  .table-modern tbody tr:hover {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
    transform: scale(1.01);
  }

  .table-modern tbody td {
    padding: 1.5rem 1rem;
    vertical-align: middle;
    border: none;
  }

  .employee-name {
    font-weight: 600;
    color: #2d3748;
    font-size: 1.05rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .employee-name i {
    color: #667eea;
    font-size: 1.2rem;
  }

  .badge-position {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-weight: 500;
    font-size: 0.85rem;
    display: inline-block;
  }

  .badge-department {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-weight: 500;
    font-size: 0.85rem;
    display: inline-block;
  }

  /* === QR CODE === */
  .qr-code-wrapper {
    position: relative;
    display: inline-block;
  }

  .qr-code-wrapper img {
    border-radius: 12px;
    padding: 0.5rem;
    background: white;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .qr-code-wrapper:hover img {
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }

  /* === MODAL QR === */
  .modal-body img {
    width: 100%;
    height: auto;
    border-radius: 20px;
    box-shadow: 0 4px 25px rgba(0, 0, 0, 0.2);
  }

  .modal-content {
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
  }

  /* === BUTTONS === */
  .btn-details {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 0.6rem 1.5rem;
    border-radius: 50px;
    border: none;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-details:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
    color: white;
  }

  .btn-delete {
    background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
    color: white;
    padding: 0.6rem 1.2rem;
    border-radius: 50px;
    border: none;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-delete:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    color: white;
  }

  /* === EMPTY STATE === */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .empty-state i {
    font-size: 5rem;
    color: #cbd5e0;
    margin-bottom: 1.5rem;
    display: block;
  }

  .empty-state h4 {
    color: #2d3748;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  .empty-state p {
    color: #718096;
    margin-bottom: 2rem;
  }

  .empty-state .btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.8rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    border: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .empty-state .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  }
</style>

<div class="mt-4">
  <div class="page-header">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <h2>{{ _("List of Employees") }}</h2>
        <p class="subtitle">{{ _("Manage your team members") }}</p>
      </div>
      <a href="{{ url_for('add_employee') }}" class="btn-add-employee">
        <i class="bi bi-person-plus-fill"></i> {{ _("Add New Employee") }}
      </a>

      <!-- 🔍 FILTER BAR -->
      <div class="filter-bar mb-4">
        <div class="filter-header mb-3">
          <i class="bi bi-funnel"></i>
          <h6 class="mb-0">{{ _("Filters") }}</h6>
        </div>

        <form method="GET" action="{{ url_for('index') }}" class="row g-3 align-items-end">

          <!-- 🔸 Recherche par nom -->
          <div class="col-md-4">
            <label for="search" class="form-label">
              <i class="bi bi-search me-1"></i>{{ _("Search by Name") }}
            </label>
            <input type="text" id="search" name="search" value="{{ request.args.get('search', '') }}"
              class="form-control" placeholder="Type a name...">
          </div>

          <!-- 🔸 Filtrer par position -->
          <div class="col-md-3">
            <label for="position" class="form-label">
              <i class="bi bi-briefcase me-1"></i>{{ _("Position") }}
            </label>
            <select id="position" name="position" class="form-select">
              <option value="">{{ _("All Positions") }}</option>
              {% for p in positions %}
              <option value="{{ p }}" {% if request.args.get('position')==p %}selected{% endif %}>{{ p }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- 🔸 Filtrer par département -->
          <div class="col-md-3">
            <label for="department" class="form-label">
              <i class="bi bi-building me-1"></i>{{ _("Department/Line") }}
            </label>
            <select id="department" name="department" class="form-select">
              <option value="">{{ _("All Departments") }}</option>
              {% for d in departments %}
              <option value="{{ d }}" {% if request.args.get('department')==d %}selected{% endif %}>{{ d }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- 🔹 Boutons Filtrer + Réinitialiser -->
          <div class="col-md-2 d-flex gap-2">
            <button type="submit" class="btn btn-primary flex-fill">
              <i class="bi bi-funnel-fill"></i>
            </button>
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary flex-fill">
              <i class="bi bi-x-circle"></i>
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>

  {% if employees %}
  <div class="employee-card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-modern align-middle mb-0">
          <thead>
            <tr class="text-center">
              <th class="text-start ps-4">{{ _("Full Name") }}</th>
              <th>{{ _("Position") }}</th>
              <th>{{ _("Department/Line") }}</th>
              <th>{{ _("QR Code") }}</th>
              <th>{{ _("Actions") }}</th>
            </tr>
          </thead>
          <tbody>
            {% for e in employees %}
            <tr class="text-center">
              <td class="text-start ps-4">
                <div class="employee-name">
                  <i class="bi bi-person-circle"></i>
                  <span>{{ e.first_name }} {{ e.last_name }}</span>
                </div>
              </td>
              <td>
                {% if e.position %}
                <span class="badge-position">{{ e.position }}</span>
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
              </td>
              <td>
                {% if e.department %}
                <span class="badge-department">{{ e.department }}</span>
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
              </td>
              <td>
                {% if e.qr_code_path %}
                <div class="qr-code-wrapper">
                  <img src="{{e.qr_code_path }}" width="70" alt="QR {{ e.first_name }}"
                    data-bs-toggle="modal" data-bs-target="#qrModal"
                    data-image="{{e.qr_code_path}}">
                </div>
                {% else %}
                <span class="text-muted fst-italic">
                  <i class="bi bi-qr-code"></i> {{ _("No QR") }}
                </span>
                {% endif %}
              </td>
              <td>
                <div class="d-flex justify-content-center gap-2 flex-wrap">
                  <a href="{{ url_for('employee_detail', employee_id=e.id) }}" class="btn-details">
                    <i class="bi bi-eye-fill"></i> {{ _("Details") }}
                  </a>
                  <form action="{{ url_for('delete_employee', employee_id=e.id) }}" method="POST"
                    onsubmit="return confirm({{ _('Are you sure you want to delete this employee?')|tojson }});">
                    <button type="submit" class="btn-delete">
                      <i class="bi bi-trash-fill"></i> {{ _("Delete") }}
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% else %}
  <div class="empty-state">
    <i class="bi bi-people"></i>
    <h4>{{ _("No employees registered yet.") }}</h4>
    <p>{{ _("Start building your team by adding your first employee.") }}</p>
    <a href="{{ url_for('add_employee') }}" class="btn">
      <i class="bi bi-plus-circle-fill"></i> {{ _("Add one now.") }}
    </a>
  </div>
  {% endif %}
</div>

<!-- === MODAL QR ZOOM === -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content p-3 text-center">
      <div class="modal-body">
        <img src="" id="qrModalImage" alt="QR Enlarged">
      </div>
    </div>
  </div>
</div>

<script>
  const qrModal = document.getElementById('qrModal');
  qrModal.addEventListener('show.bs.modal', event => {
    const img = event.relatedTarget;
    const src = img.getAttribute('data-image');
    document.getElementById('qrModalImage').src = src;
  });
</script>

{% endblock %}